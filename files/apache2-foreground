#!/bin/sh
set -e

# Ensure /code/web directory exists, preventing Apache from crashing.
mkdir -p /code/web

# Ensure $BASE_PATH starts with a slash.
BASE_PATH=$(echo ${BASE_PATH} | sed 's#^\([^/]\)#/\1#')

# If there is a BASE_PATH set, create an alias for it.
if [[ ${BASE_PATH} ]]; then
  mkdir -p /var/www/html${BASE_PATH}
  ln -sf /code/web /var/www/html${BASE_PATH}

  # An alternative to this mkdir/ln method is to create an alias, but it
  # requires root permissions.
  #echo 'Alias "${BASE_PATH}" "/code/web"' > /etc/apache2/conf-enabled/path-aliases.conf
fi

exec apache2 -D FOREGROUND
